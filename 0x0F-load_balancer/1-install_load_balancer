#!/usr/bin/env bash
# Install and configure HAproxy

sudo apt-get install --no-install-recommends software-properties-common -y
sudo add-apt-repository ppa:vbernat/haproxy-2.9 -y
sudo apt-get install haproxy=2.9.\* -y

sudo sed '/errorfile 504 \/etc\/haproxy\/errors\/504.http/a\\nlisten web_servers\n\tbind *:80\n\tmode http\n\tmode http\n\tbalance roundrobin\n\tserver 285366-web-01 34.224.63.137:80 check\n\tserver 285366-web-02 100.25.192.100:80 check\n' /etc/haproxy/haproxy.cfg | sudo tee haproxy.cfg

sudo mv -f haproxy.cfg /etc/haproxy/haproxy.cfg
sudo service haproxy restart
